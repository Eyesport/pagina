
/**
 * @namespace aria
 */
var aria = aria || {};

aria.NoticiasData = [
  {
    name: '<strong>Deportivo Lara ya Arrancó a Brasil</strong>',
    id: '1',
    type:'   <p> <strong>El Deportivo Lara</strong>  ya tomó su vuelo a <strong>Brasil</strong>  para disputar el encuentro de <strong>Copa Libertadores ante el Cruzeiro en Belo Horizonte.</strong></p>',
    image: 'pages/futbol/imgfutbol/deportivo-a-brasil.jpg',
    audio: "pages/futbol/audiofutbol/",
    link:"pages/futbol/noticias/deportivo-brasil.html"
  },
  {
    name: '<strong>La Vinotinto Impecable Ante Argentina</strong>',
    id: '2',
    type:'     <p> <strong>Venezuela</strong> disputó su primer juego ante <strong>Argentina</strong>  en este 2019, encuentro que se llevó a cabo en el <strong>Wanda Metropolitano</strong>  y quienes asistieron fueron testigos de un partido histórico para la <strong>Selección Nacional</strong>, debido a que, lograron su segunda victoria histórica ante la <strong>albiceleste</strong>  por un marcador de 3 a 1 este viernes 22 de marzo, con los goles de <strong>Salomón Rondón, Jhon Murillo y Josef Martínez</strong> de penal. </p>',
    image: 'pages/futbol/imgfutbol/vinotinto-vence-argentina.jpg',
    audio: "pages/futbol/audiofutbol/",
    link:"pages/futbol/noticias/vinotinto-gano.html"
  },
  {
    name: '<strong>Lara, Zamora, Carabobo y Trujillanos triunfaron el sábado</strong>',
    id: '3',
    type:'    <p> <strong>Zamora, Carabobo, Lara y trujillanos</strong> resultaron victoriosos en la jornada sabatina por el <strong>Torneo Apertura de la Liga FUTVE.</strong>  </p>',
    image: 'pages/futbol/imgfutbol/lara-zamora-trujillanos.jpg',
    audio: "pages/futbol/audiofutbol",
    link:"pages/futbol/noticias/lara-zamora-trujillanos.html"
  },
  {
    name: '<strong>Miguel Cabrera Logró su Cuarto Cuadrangular de la Pretemporada</strong>',
    id: '4',
    type:'      <p> El toletero criollo <strong>Miguel Cabrera</strong> conectó su cuarto estacazo para la calle en los <strong>Spring Trainning</strong>, este <strong>sábado 23 de marzo</strong>, en una victoria de los <strong>Tigres de Detroit</strong> ante las <strong>Rayas de Tampa Bay</strong> 8 carreras a 7.</p',
    image: 'pages/beisbol/imgbeisbol/Miguel-cabrera-cuarto-cuadrangular.jpg',
    audio: "pages/beisbol/audiobeisbol",
    link:"pages/beisbol/noticias/cabrera-cuadrangular.html"
  },
  {
    name: '<strong>Gleyber Torres se Fue por Cuarta Vez a la Calle</strong>',
    id: '5',
    type:'    <p> La gran ofensiva del caraqueño <strong>Gleyber Torres</strong>  volvió a despertar en esta <strong>pretemporada</strong>  al conectar su cuarto bambinazo de los <strong>Spring Trainning</strong>, un cuadrangular de 3 carreras en el primer episodio, pero que no pudo evitar la derrota de <strong>los Yankees de Nueva York</strong>  al caer 7 a 3 ante <strong>los Azulejos de Toronto.</strong></p>',
    image: 'pages/beisbol/imgbeisbol/gleyber-torres.jpg',
    audio: "pages/beisbol/audiobeisbol",
    link:"pages/beisbol/noticias/gleyber.html"
  },
  ,
  {
    name: '<strong>La “Barba” Harden Imparable</strong>',
    id: '10',
    type:'     <p>La figura de los <strong>Houston Rockets</strong> está teniendo una temporada increíble que a los demás equipos no le agrada mucho. El escolta está incluso alcanzando récords en la <strong>NBA</strong>, registros de los icónicos <strong>Wilt Chamberlain, Kareem Abdul-Jabbar, Michael Jordan o Kobe Bryant</strong> que parecía que nadie podría volver a igualar. </p>',
    image: 'pages/basquet/imgbasquet/Barba-Harden.jpg',
    audio: "pages/basquet/audiobasquet",
    link:"pages/basquet/noticias/barba-harden.html"
  },
  {
    name: '<strong>Pogba dio un Pequeño guiño al Madrid y a Zidane</strong>',
    id: '6',
    type:'    <p> <strong>Paul Pogba</strong> dio unas declaraciones en rueda de prensa desde <strong>Clairefontaine</strong>, lugar donde está concentrado con la selección de Francia como preparación para el partido de clasificación para la <strong>Eurocopa 2020</strong> ante Moldavia. El jugador del <strong>Manchester United</strong> puso en juego la posibilidad de que haya una intención de fichar por el <strong>Real Madrid</strong>, debido a que, le preguntaron y su respuesta fue “El Madrid es un club de ensueño para todos, uno de los más grandes del mundo.” </p>',
    image: 'pages/futbol/imgfutbol/Pogba-madrid.jpg',
    audio: "pages/futbol/audiofutbol",
    link:"pages/futbol/noticias/pogba-madrid.html"
  },
  {
    name: '<strong>Icardi Volverá a las Prácticas con el Inter</strong>',
    id: '7',
    type:'    <p> El argentino <strong>Mauro Icardi</strong> volverá a entrenarse con su equipo luego de estar más de un mes apartado del <strong>Inter de Milán</strong>, según lo informó <strong>“La Gazzetta dello Sport”</strong>. El jugador fue apartado por el equipo por las polémicas con su renovación y además las continuas declaraciones aún más polémicas de su esposa <strong>Wanda Nara.</strong></p>',
    image: 'pages/futbol/imgfutbol/Icardi-inter.jpg',
    audio: "pages/futbol/audiofutbol",
    link:"pages/futbol/noticias/icardi-inter.html"
  },
  {
    name: '<strong>Brillante Actuación de Lio Messi</strong>',
    id: '8',
    type:'   <p>  El astro argentino del <strong>Futbol Club Barcelona, Lionel Messi</strong>, completó este domingo ante el Real Betis una esplendida actuación por el partido de Liga, donde junto a la genialidad de <strong>Luis Suárez<strong> lograron darle el triunfo al <strong>Barcelona 4 a 1;</strong> quienes son más lideres que nunca a pocas fechas de culminar el campeonato liguero. </p>',
    image: 'pages/futbol/imgfutbol/brillante-messi.jpg',
    audio: "pages/futbol/audiofutbol/messibetis.mp3",
    link:"pages/futbol/noticias/messi-brillante.html"
  },
  {
    name: '<strong>Messi Regresa con la Selección de Argentina</strong> ',
    id: '9',
    type:'   <p>  <strong>Lionel Messi</strong> vuelve a los entrenamientos con la <strong>Selección Argentina</strong> tras casi 8 meses de haber dejado a la albiceleste, luego de su atropellada salida desde haber dejado la selección cuando quedaron eliminados del <strong>Mundial de Rusia 2018.</strong> El argentino regresa a tono tras haber completado una gran actuación en La Liga ante el Real Betis. Llega para reforzar a una albiceleste que no contará con la incorporación de <strong>Nicolas Otamendi</strong>, tras sufrir un esguince en un encuentro con el Manchester City y de cara a lo que será la próxima edición de la <strong>Copa América de Brasil 2019.</strong></p>',
    image: 'pages/futbol/imgfutbol/messi-vuelve.jpg',
    audio: "pages/futbol/audiofutbol/messi-arg.mp3",
    link:"pages/futbol/noticias/messi-regresa.html"
  }
];

aria.FeedDisplay = function (feed, fetchData) {
  this.feed = feed;
  this.feedNode = feed.getFeedNode();
  this.fetchData = fetchData;
  this.currentPage = 0;
  this.perPage = 10;
  this.feedSize = 0;
  this.feedItems = [];
  this.loading = false;
  this.loadingDelay = 200;

  this.lastChecked = Date.now();
  this.loadData();
  this.setupEvents();
};

aria.FeedDisplay.prototype.setDelay = function (delay) {
  this.loadingDelay = delay;
};

aria.FeedDisplay.prototype.loadData = function () {
  var feedData = this.fetchData(this.currentPage, this.perPage);

  if (!this.feedNode || this.loading) {
    return;
  }

  this.feedNode.setAttribute('aria-busy', 'true');
  this.loading = true;

  var loadingItems = [];

  Array.prototype.forEach.call(feedData, function (itemData) {
    var newFeedItem = this.renderItemData(itemData);
    loadingItems.push(newFeedItem);
  }, this);

  this.delayRender(
    loadingItems,
    function () {
      this.feedNode.removeAttribute('aria-busy');
      this.loading = false;
      this.checkLoadMore();
    }.bind(this)
  );
};

aria.FeedDisplay.prototype.delayRender = function (items, onRenderDone) {
  if (!items || !items.length) {
    onRenderDone();
    return;
  }

  var newFeedItem = items.shift();
  this.feedNode.appendChild(newFeedItem);
  this.feedItems.push(newFeedItem);
  this.feed.addItem(newFeedItem);

  this.feedItems.forEach(function (feedItem) {
    feedItem.setAttribute('aria-setsize', this.feedItems.length);
  }, this);

  setTimeout((function () {
    this.delayRender(items, onRenderDone);
  }).bind(this), this.loadingDelay);
};

function focusArticulo(archivo_audio) {
  var sonido = new Audio(archivo_audio);

  sonido.play();
}
function goToLink (event, url) {
  var type = event.type;

  if (
    (type === 'click') ||
    (type === 'keydown' && event.keyCode === 13)
  ) {
    window.location.href = url;

    event.preventDefault();
    event.stopPropagation();
  }
}
aria.FeedDisplay.prototype.renderItemData = function (itemData) {
  var feedItem = document.createElement('div');
  this.feedSize++;

  feedItem.setAttribute('role', 'article');
  feedItem.className = 'noticias-item';
  feedItem.setAttribute('aria-posinset', this.feedSize);
  feedItem.setAttribute('tabindex', '0');
  feedItem.setAttribute('onfocus', "focusArticulo('" + itemData.audio + "')");
  feedItem.setAttribute('id', 'f' + itemData.id);
  feedItem.setAttribute('onkeydown',"goToLink(event,'" + itemData.link + "')");
  feedItem.setAttribute('onclick',"goToLink(event,'" + itemData.link + "')");


  var itemDetails = document.createElement('div');
  itemDetails.className = 'noticias-details';
  var itemContent = '';
  var describedbyIDs = [];
  var noticiasID = 'noticias-name-' + this.feedSize;
  feedItem.setAttribute('aria-labelledby', noticiasID);

  itemContent += '<div class="noticias-name" ' +
    'id="' + noticiasID + '">' +
    itemData.name +
    '</div>';

  if (itemData.image) {
    itemContent += '<div class="noticias-image"> <img src="' +
      itemData.image +
      '"></div>';
  }

  if (itemData.rating) {
    var ratingID = 'noticias-rating-' + this.feedSize;
    itemContent += '<div id="' + ratingID + '">' +
      '</div>';
    describedbyIDs.push(ratingID);
  }

  if (itemData.type) {
    var typeID = 'noticias-type-' + this.feedSize;
    itemContent += '<div class="noticias-type" id="' + typeID + '">' +
      itemData.type +
      '</div>';
    describedbyIDs.push(typeID);
  }

  itemDetails.innerHTML = itemContent;
  feedItem.appendChild(itemDetails);

  var locationBlock = document.createElement('div');
  var locationID = 'noticias-location-' + this.feedSize;
  locationBlock.setAttribute('id', locationID);
  locationBlock.className = 'location-block';
  var locationContent = '';
  describedbyIDs.push(locationID);



  locationBlock.innerHTML = locationContent;
  feedItem.appendChild(locationBlock);

  feedItem.setAttribute('aria-describedby', describedbyIDs.join(' '));

  var actions = document.createElement('div');
  actions.className = 'noticias-actions';
  actions.innerHTML = '';
  actions.setAttribute('href', itemData.link );
  feedItem.appendChild(actions);

  return feedItem;
};

aria.FeedDisplay.prototype.setupEvents = function () {
  window.addEventListener('scroll', this.handleScroll.bind(this));
};

aria.FeedDisplay.prototype.handleScroll = function () {
  var now = Date.now();

  if ((this.lastChecked + 100 - now) < 0) {
    this.checkLoadMore();
    this.lastChecked = now;
  }
};

aria.FeedDisplay.prototype.checkLoadMore = function () {
  if (!this.feedItems || !this.feedItems.length) {
    return;
  }

  var lastFeedItem = this.feedItems[this.feedItems.length - 1];
  var scrollTop = window.pageYOffset ||
    document.documentElement.scrollTop ||
    document.body.scrollTop ||
    0;
  var scrollBottom = scrollTop + window.innerHeight;


};