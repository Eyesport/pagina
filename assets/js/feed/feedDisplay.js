
/**
 * @namespace aria
 */
var aria = aria || {};

aria.NoticiasData = [
  {
    name: '<strong>Brillante Actuación de Lio Messi</strong>',
    id: 1,
    type:'El astro argentino del <strong>Futbol Club Barcelona, Lionel Messi</strong>, completó este domingo ante el Real Betis una esplendida actuación por el partido de Liga, donde junto a la genialidad de <strong>Luis Suárez<strong> lograron darle el triunfo al <strong>Barcelona 4 a 1;</strong> quienes son más lideres que nunca a pocas fechas de culminar el campeonato liguero.',
    image: 'pages/futbol/imgfutbol/messi-betis.jpg',
    audio: "pages/futbol/audiofutbol/messibetis.mp3",
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name: '<strong>La Vinotinto se Enfrentará Ante Argentina</strong>',
    id: 2,
    type: '<strong>El combinado Vinotinto</strong> se enfrentará este <strong>viernes 22 de marzo</strong> ante la Selección de Argentina en el <strong>Wanda Metropolitano</strong> en la ciudad de Madrid, estadio que le pertenece al <strong>Atlético de Madrid.</strong> Una selección argentina que reincorpora a Messi nuevamente a su grupo de convocados.',
    image: 'pages/futbol/imgfutbol/Selevinotinto.jpg',
    audio: "pages/futbol/audiofutbol/vzla-argentina.mp3",
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>Messi Regresa con la Selección de Argentina</strong>',
    id:'10',
    type:'     <strong>Lionel Messi</strong> vuelve a los entrenamientos con la <strong>Selección Argentina</strong> tras casi 8 meses de haber dejado a la albiceleste, luego de su atropellada salida desde haber dejado la selección cuando quedaron eliminados del <strong>Mundial de Rusia 2018.</strong> El argentino regresa a tono tras haber completado una gran actuación en La Liga ante el Real Betis. Llega para reforzar a una albiceleste que no contará con la incorporación de <strong>Nicolas Otamendi</strong>, tras sufrir un esguince en un encuentro con el Manchester City y de cara a lo que será la próxima edición de la <strong>Copa América de Brasil 2019.</strong>',
    image:'pages/futbol/imgfutbol/messi-pechofrio.jpg',
    audio:'pages/futbol/audiofutbol/messi-arg.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name: '<strong>Venezuela Queda en el Grupo A en el Mundial de China</strong>',
    id: 3,
    type: '  <strong>Shenzhen</strong> fue el escenario donde la selección de baloncesto de Venezuela conoció el camino que le tocará transitar en el <strong>Mundial de China 2019.</strong> Los bombos arrojaron que los criollos conforman el <strong>Grupo A</strong> junto a <strong>Costa de Marfil, Polonia y China.</strong>',
    image: 'pages/basquet/imgbasquet/basquet-vzla.jpg',
    audio: "pages/basquet/audiobasquet/vzla-china-basquet.mp3",
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name: '<strong>Mike Trout: Un contrato fuera de órbita</strong>',
    id: 4,
    type:'Lo que se creía una locura de contrato, tal como lo fue el de <strong>Bryce Harper cuando pactó con los Philips de Philadelphia por 13 años y 330 millones de dólares</strong>, se queda corto comparado con el contrato que pudiera llegar a firmar <strong>Mike Trout</strong> al extender su vínculo con los <strong>Angels de los Ángeles de Anaheim</strong>, el cual tiene la gran suma de <strong>430 millones de dólares por 12 años.</strong>',
    image: 'pages/beisbol/imgbeisbol/contrato-beisbol.jpg',
    audio: "pages/beisbol/audiobeisbol/miketrout.mp3",
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>Todo Listo Para los Cuartos de Final de la UEFA Champions League</strong>',
    id:'5',
    type:'     <strong>Luego de completarse todas las jornadas de octavos de final</strong>, se realizó el sorteo para conocer los cruces de <strong>cuartos de final de la Liga de Campeones</strong>, el emparejamiento de equipos se llevó a cabo en la sede de la <strong>UEFA, en Nyon Suiza<strong>, dejando los siguientes duelos: <strong>Ajax – Juventus. Manchester United – Barcelona. Totthenham – Manchester City y Liverpool – Porto.</strong> Estos fueron los cuatro cruces que dejó el sorteo.',
    image:'pages/futbol/imgfutbol/sorteo-champions.jpg',
    audio:'pages/futbol/audiofutbol/cuartoschampions.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>Manny Machado logra contrato estratosférico con los Padres de San Diego</strong>',
    id:'6',
    type:'     El ex <strong>Dodgers de los Angeles</strong> firmó un contrato de 10 años con los <strong>Padres de San Diego por un total de 300 millones de dólares</strong>, el mismo habría establecido un <strong>récord</strong> en cuanto a los contratos a largo plazo y también cómo el contrato mejor pagado siendo un agente libre.',
    image:'pages/beisbol/imgbeisbol/manny-machado.jpg',
    audio:'pages/beisbol/audiobeisbol/manny.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>El triplecoronado Miguel Cabrera regresó a la caja de bateo</strong>',
    id:'7',
    type:'     <strong>Miguel Cabrera</strong> se reportó a los entrenamientos de los <strong>Tigres de Detroit</strong>, antes del comienzo del <strong>Spring Training</strong> y la nueva campaña de la <strong>Mejor League Béisbol (MLB).</strong> El toletero criollo oriundo de Maracay lució bastante sólido y en condiciones en cada batazo que conectaba, esto tras su operación el pasado junio.',
    image:'pages/beisbol/imgbeisbol/miguel-cabrera.jpg',
    audio:'pages/beisbol/audiobeisbol/miguelcabrera.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>La promesa de Zlatan Ibrahimovic</strong>',
    id:'8',
    type:'     El astro sueco <strong>Zlatan Ibrahimovic</strong> jugador de <strong>los Angeles Galaxy</strong>, quien comienza su segunda temporada en la <strong>Major League Soccer (MLS) </strong>, afirmó durante la presentación del nuevo uniforme alternativo del equipo que estaba preparado y listo para romper todos los records existentes en la competencia.',
    image:'pages/futbol/imgfutbol/zlatan.jpg',
    audio:'pages/futbol/audiofutbol/zlatan.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>Guaros de Lara viajaran a Argentina</strong>',
    id:'9',
    type:'     El equipo larense de baloncesto, <strong>Guaros de Lara</strong>, viajarán a <strong>Buenos Aires, Argentina</strong>, para encarar la segunda semifinal de la Liga de las Américas, después que <strong>la Federación Internacional de Baloncesto (FIBA) en las Américas</strong>, confirmara a San Lorenzo de Almagro como el anfitrión para esta fase de la competencia, el polideportivo Roberto Pando.',
    image:'pages/basquet/imgbasquet/guaros-lara.jpg',
    audio:'pages/basquet/audiobasquet/guaros.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>El Barcelona se impone sobre el Real Madrid en Copa del Rey</strong>',
    id:'11',
    type:'     <strong>El FC Barcelona</strong> se impuso ante el <strong>Real Madrid</strong>en el partido de vuelta de la semifinal de <strong>Copa del Rey en el Santiago Bernabéu</strong>, con un marcador de 3 goles por 0, encuentro en el que el equipo merengue parecía lucir superior, sobre todo en el primer tiempo cuando tenía asediada el área del equipo culé, generando muchas oportunidades de gol, pero ninguna concretada con éxito.',
    image:'pages/futbol/imgfutbol/barca-real.jpg',
    audio:'pages/futbol/audiofutbol/barcamadrid.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>Cardenales de Lara Campeón Por Quinta Vez en el Béisbol Criollo</strong>',
    id:'12',
    type:'     <strong>Cardenales de Lara</strong> se hizo con el campeonato de la <strong>Liga Venezolana de Béisbol Profesional (LVBP)</strong> al vencer a los <strong>Leones del Caracas</strong> 4 juegos a 1 en la serie. El equipo crepuscular solo necesitó de 5 juegos para superar a los melenudos en una final histórica del béisbol criollo.',
    image:'pages/beisbol/imgbeisbol/cardenales-campeon.jpg',
    audio:'pages/beisbol/audiobeisbol/cardenalescampeon.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>Toros de Herrera se coronó campeón de la Serie del Caribe</strong>',
    id:'13',
    type:'<strong>La Serie del Caribe 2019</strong> finalizo este domingo (10/02) con la victoria de <strong>Toros de Herrera (Panamá)</strong> 3 carreras por 1 ante <strong>Leñadores de Las Tunas (Cuba)</strong> para apuntarse su segundo título en la historia, el primero lo obtuvo en 1950 con los Yankees de Carta Vieja.',
    image:'pages/beisbol/imgbeisbol/torosherrera.jpg',
    audio:'pages/beisbol/audiobeisbol/torosherrera.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>Los Lakers siguen en caída cada vez más</strong>',
    id:'15',
    type:'     En la noche de este lunes <strong>los Lakers de Los Ángeles</strong> terminaron derrotados ante <strong>los Grizzlies de Memphis con score de 110-105</strong>, dejando con menos esperanzas de clasificación a la franquicia angelina.',
    image:'pages/basquet/imgbasquet/lakers.jpg',
    audio:'pages/basquet/audiobasquet/lakers.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>El Tottenham logra milagroso empate ante el Arsenal</strong>',
    id:'16',
    type:'     El guardameta francés <strong>Hugo Lloris</strong> fue clave para el empate del Tottenham luego que tapara un penalti al gabonés <strong>Pierre Emerick Aubameyang</strong> en el <strong>minuto 91</strong> del encuentro. Al igual que <strong>Harry Kane</strong> quien a <strong>un cuarto de hora del final del partido pudo marcara el gol del empate</strong> para lograr salvar un punto ante los gunners.',
    image:'pages/futbol/imgfutbol/totten.jpg',
    audio:'pages/futbol/audiofutbol/totteham.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  },
  {
    name:'<strong>Cristiano con problemas en el tobillo</strong>',
    id:'17',
    type:'     El astro portugués se entrena al margen con el equipo, luego de recibir un golpe en el tobillo que le ha causado molestias desde entonces. Este miércoles debido a las molestias se someterá en las próximas horas a uno controles por un golpe en el tobillo izquierdo.',
    image:'pages/futbol/imgfutbol/cristiano-molestias.jpg',
    audio:'pages/futbol/audiofutbol/cr7.mp3',
    link:"https://www.youtube.com/watch?v=-n9krkSb-ug"
  }

];

aria.FeedDisplay = function (feed, fetchData) {
  this.feed = feed;
  this.feedNode = feed.getFeedNode();
  this.fetchData = fetchData;
  this.currentPage = 0;
  this.perPage = 10;
  this.feedSize = 0;
  this.feedItems = [];
  this.loading = false;
  this.loadingDelay = 200;

  this.lastChecked = Date.now();
  this.loadData();
  this.setupEvents();
};

aria.FeedDisplay.prototype.setDelay = function (delay) {
  this.loadingDelay = delay;
};

aria.FeedDisplay.prototype.loadData = function () {
  var feedData = this.fetchData(this.currentPage, this.perPage);

  if (!this.feedNode || this.loading) {
    return;
  }

  this.feedNode.setAttribute('aria-busy', 'true');
  this.loading = true;

  var loadingItems = [];

  Array.prototype.forEach.call(feedData, function (itemData) {
    var newFeedItem = this.renderItemData(itemData);
    loadingItems.push(newFeedItem);
  }, this);

  this.delayRender(
    loadingItems,
    function () {
      this.feedNode.removeAttribute('aria-busy');
      this.loading = false;
      this.checkLoadMore();
    }.bind(this)
  );
};

aria.FeedDisplay.prototype.delayRender = function (items, onRenderDone) {
  if (!items || !items.length) {
    onRenderDone();
    return;
  }

  var newFeedItem = items.shift();
  this.feedNode.appendChild(newFeedItem);
  this.feedItems.push(newFeedItem);
  this.feed.addItem(newFeedItem);

  this.feedItems.forEach(function (feedItem) {
    feedItem.setAttribute('aria-setsize', this.feedItems.length);
  }, this);

  setTimeout((function () {
    this.delayRender(items, onRenderDone);
  }).bind(this), this.loadingDelay);
};

function focusArticulo(archivo_audio) {
  var sonido = new Audio(archivo_audio);

  sonido.play();
}
function goToLink (event, url) {
  var type = event.type;

  if (
    (type === 'click') ||
    (type === 'keydown' && event.keyCode === 13)
  ) {
    window.location.href = url;

    event.preventDefault();
    event.stopPropagation();
  }
}
aria.FeedDisplay.prototype.renderItemData = function (itemData) {
  var feedItem = document.createElement('div');
  this.feedSize++;

  feedItem.setAttribute('role', 'article');
  feedItem.className = 'noticias-item';
  feedItem.setAttribute('aria-posinset', this.feedSize);
  feedItem.setAttribute('tabindex', '0');
  feedItem.setAttribute('onfocus', "focusArticulo('" + itemData.audio + "')");
  feedItem.setAttribute('id', 'f' + itemData.id);
  feedItem.setAttribute('onkeydown',"goToLink(event,'" + itemData.link + "')");
  feedItem.setAttribute('onclick',"goToLink(event,'" + itemData.link + "')");


  var itemDetails = document.createElement('div');
  itemDetails.className = 'noticias-details';
  var itemContent = '';
  var describedbyIDs = [];
  var noticiasID = 'noticias-name-' + this.feedSize;
  feedItem.setAttribute('aria-labelledby', noticiasID);

  itemContent += '<div class="noticias-name" ' +
    'id="' + noticiasID + '">' +
    itemData.name +
    '</div>';

  if (itemData.image) {
    itemContent += '<div class="noticias-image"> <img src="' +
      itemData.image +
      '"></div>';
  }

  if (itemData.rating) {
    var ratingID = 'noticias-rating-' + this.feedSize;
    itemContent += '<div id="' + ratingID + '">' +
      '</div>';
    describedbyIDs.push(ratingID);
  }

  if (itemData.type) {
    var typeID = 'noticias-type-' + this.feedSize;
    itemContent += '<div class="noticias-type" id="' + typeID + '">' +
      itemData.type +
      '</div>';
    describedbyIDs.push(typeID);
  }

  itemDetails.innerHTML = itemContent;
  feedItem.appendChild(itemDetails);

  var locationBlock = document.createElement('div');
  var locationID = 'noticias-location-' + this.feedSize;
  locationBlock.setAttribute('id', locationID);
  locationBlock.className = 'location-block';
  var locationContent = '';
  describedbyIDs.push(locationID);



  locationBlock.innerHTML = locationContent;
  feedItem.appendChild(locationBlock);

  feedItem.setAttribute('aria-describedby', describedbyIDs.join(' '));

  var actions = document.createElement('div');
  actions.className = 'noticias-actions';
  actions.innerHTML = '';
  actions.setAttribute('href', itemData.link );
  feedItem.appendChild(actions);

  return feedItem;
};

aria.FeedDisplay.prototype.setupEvents = function () {
  window.addEventListener('scroll', this.handleScroll.bind(this));
};

aria.FeedDisplay.prototype.handleScroll = function () {
  var now = Date.now();

  if ((this.lastChecked + 100 - now) < 0) {
    this.checkLoadMore();
    this.lastChecked = now;
  }
};

aria.FeedDisplay.prototype.checkLoadMore = function () {
  if (!this.feedItems || !this.feedItems.length) {
    return;
  }

  var lastFeedItem = this.feedItems[this.feedItems.length - 1];
  var scrollTop = window.pageYOffset ||
    document.documentElement.scrollTop ||
    document.body.scrollTop ||
    0;
  var scrollBottom = scrollTop + window.innerHeight;


};